<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2pdf.js for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" xintegrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for printing */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background-color: white;
            }
            .no-print {
                display: none;
            }
            main.grid {
                display: block; /* Override grid to stack elements */
            }
            #invoice-preview-wrapper {
                box-shadow: none;
                border-radius: 0;
                padding: 0;
                margin: 0;
            }
            /* Menambahkan rule ini untuk memaksa pencetakan warna latar belakang */
            thead.bg-slate-100 {
                -webkit-print-color-adjust: exact; /* Untuk Chrome, Safari, etc. */
                print-color-adjust: exact; /* Standar */
            }
        }
        /* Style for input fields */
        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Paid Stamp Style */
        /* This style is no longer needed and has been removed. */
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="mb-8 text-center no-print">
            <h1 class="text-4xl font-bold text-slate-900">Pembuat Invoice</h1>
            <p class="text-slate-600 mt-2">Isi formulir di bawah ini untuk membuat invoice profesional.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Form Section -->
            <div class="bg-white p-6 rounded-2xl shadow-lg no-print">
                <div class="space-y-6">
                    <!-- From & To Section -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-slate-700">Dari:</h3>
                            <input id="from-name" type="text" placeholder="Nama Anda / Perusahaan" class="form-input mb-2">
                            <textarea id="from-address" placeholder="Alamat Anda" class="form-input" rows="3"></textarea>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-slate-700">Untuk:</h3>
                            <input id="to-name" type="text" placeholder="Nama Klien / Perusahaan" class="form-input mb-2">
                            <textarea id="to-address" placeholder="Alamat Klien" class="form-input" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <!-- Invoice Details -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                         <div>
                            <label for="invoice-number" class="block text-sm font-medium text-slate-600 mb-1">No. Invoice</label>
                            <input id="invoice-number" type="text" value="INV-2024-001" class="form-input">
                        </div>
                        <div>
                            <label for="invoice-date" class="block text-sm font-medium text-slate-600 mb-1">Tanggal Terbit</label>
                            <input id="invoice-date" type="date" class="form-input">
                        </div>
                    </div>

                    <!-- Items Section -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2 text-slate-700">Rincian Item</h3>
                        <div id="item-list" class="space-y-4">
                            <!-- Item rows will be dynamically added here -->
                        </div>
                        <button id="add-item" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            + Tambah Item
                        </button>
                    </div>

                    <!-- Notes Section -->
                     <div>
                        <label for="notes" class="block text-lg font-semibold mb-2 text-slate-700">Catatan / Syarat & Ketentuan</label>
                        <textarea id="notes" class="form-input" placeholder="Pembayaran dapat dilakukan melalui transfer bank" rows="3"></textarea>
                    </div>

                     <!-- Status Section -->
                     <div class="pt-4 border-t border-slate-200">
                        <div class="flex items-center">
                            <input id="paid-status" type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                            <label for="paid-status" class="ml-3 block text-sm font-medium text-slate-700">Tandai sebagai LUNAS</label>
                        </div>
                    </div>


                    <!-- Action Button -->
                    <div class="pt-4 border-t border-slate-200">
                        <button id="print-btn" class="w-full bg-slate-700 hover:bg-slate-800 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            Cetak Invoice
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div id="invoice-preview-wrapper" class="bg-white p-4 sm:p-8 lg:p-12 rounded-2xl shadow-lg">
                <div id="invoice-preview" class="w-full h-full relative">
                    <!-- Paid Stamp is removed from here -->

                    <header class="flex justify-between items-start pb-8 mb-8 border-b border-slate-400">
                        <div>
                            <h2 class="text-3xl font-bold text-slate-900" id="preview-from-name">Nama Perusahaan Anda</h2>
                            <p class="text-slate-500 whitespace-pre-line" id="preview-from-address">Alamat Anda</p>
                        </div>
                        <h1 class="text-4xl font-bold text-slate-400 uppercase tracking-widest">Invoice</h1>
                    </header>

                    <section class="flex justify-between mb-8">
                        <div>
                            <h4 class="font-semibold text-slate-600 mb-1">Ditagihkan Kepada:</h4>
                            <p class="font-bold text-slate-800" id="preview-to-name">Nama Klien</p>
                            <p class="text-slate-500 whitespace-pre-line" id="preview-to-address">Alamat Klien</p>
                        </div>
                        <div class="text-right">
                            <p><span class="font-semibold text-slate-600">No. Invoice:</span> <span id="preview-invoice-number">INV-2024-001</span></p>
                            <p><span class="font-semibold text-slate-600">Tanggal:</span> <span id="preview-invoice-date">-</span></p>
                        </div>
                    </section>
                    
                    <section class="py-8 my-8 border-y border-slate-400">
                        <table class="w-full text-left">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="p-3 font-semibold text-slate-600 uppercase">Deskripsi</th>
                                    <th class="p-3 font-semibold text-slate-600 uppercase text-center">Jumlah</th>
                                    <th class="p-3 font-semibold text-slate-600 uppercase text-right">Harga Satuan</th>
                                    <th class="p-3 font-semibold text-slate-600 uppercase text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody id="preview-item-list" class="divide-y divide-slate-300">
                                <!-- Preview items will be dynamically added here -->
                            </tbody>
                        </table>
                    </section>

                    <section class="flex justify-end pt-8 mb-8">
                        <div class="w-full max-w-sm">
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="font-semibold text-slate-600">Subtotal</span>
                                    <span id="preview-subtotal">Rp 0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-slate-600">Pajak (%)</span>
                                    <input id="tax-rate" type="number" value="11" class="form-input w-20 text-right no-print">
                                    <span id="preview-tax" class="text-right">Rp 0</span>
                                </div>
                                <div class="flex justify-between border-t-2 border-slate-400 pt-3">
                                    <span class="font-bold text-xl text-slate-800">TOTAL</span>
                                    <span id="preview-total" class="font-bold text-xl text-slate-800">Rp 0</span>
                                </div>
                                <!-- New Payment Status Badge -->
                                <div id="payment-status-wrapper" class="text-right pt-3" style="display: none;">
                                    <span class="bg-emerald-700 text-white text-sm font-bold uppercase px-4 py-2 rounded-md tracking-wider">Lunas</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <footer class="border-t border-slate-400 pt-8">
                        <h4 class="font-semibold text-slate-600 mb-2">Catatan</h4>
                        <p class="text-slate-500 text-sm whitespace-pre-line" id="preview-notes">Pembayaran dapat dilakukan melalui transfer bank</p>
                    </footer>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Element References
            const itemList = document.getElementById('item-list');
            const previewItemList = document.getElementById('preview-item-list');
            
            // Mapping from input IDs to preview element IDs
            const bindings = {
                'from-name': 'preview-from-name',
                'from-address': 'preview-from-address',
                'to-name': 'preview-to-name',
                'to-address': 'preview-to-address',
                'invoice-number': 'preview-invoice-number',
                'notes': 'preview-notes',
            };
            
            // Currency Formatter
            const currencyFormatter = new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            });

            // Initial state
            let itemCounter = 0;

            // Functions
            function updatePreview(inputId, previewId) {
                const inputElement = document.getElementById(inputId);
                const previewElement = document.getElementById(previewId);
                if (inputElement && previewElement) {
                    previewElement.textContent = inputElement.value || previewElement.dataset.placeholder;
                }
            }

            function updateDate(inputId, previewId) {
                const inputElement = document.getElementById(inputId);
                const previewElement = document.getElementById(previewId);
                if (inputElement && previewElement) {
                     if (inputElement.value) {
                        const date = new Date(inputElement.value);
                        previewElement.textContent = date.toLocaleDateString('id-ID', {
                            day: '2-digit', month: 'long', year: 'numeric'
                        });
                    } else {
                        previewElement.textContent = '-';
                    }
                }
            }

            function formatCurrency(amount) {
                return currencyFormatter.format(amount || 0);
            }

            function calculateTotals() {
                let subtotal = 0;
                const itemRows = itemList.querySelectorAll('.item-row');
                
                itemRows.forEach(row => {
                    const qtyInput = row.querySelector('.item-qty');
                    const priceInput = row.querySelector('.item-price');
                    const id = qtyInput.dataset.id;
                    
                    const qty = parseFloat(qtyInput.value) || 0;
                    const price = parseFloat(priceInput.value) || 0;
                    const total = qty * price;

                    const previewRow = previewItemList.querySelector(`#preview-item-${id}`);
                    if (previewRow) {
                        previewRow.querySelector('.item-total').textContent = formatCurrency(total);
                    }
                    subtotal += total;
                });

                const taxRate = parseFloat(document.getElementById('tax-rate').value) || 0;
                const tax = subtotal * (taxRate / 100);
                const total = subtotal + tax;
                
                document.getElementById('preview-subtotal').textContent = formatCurrency(subtotal);
                document.getElementById('preview-tax').textContent = formatCurrency(tax);
                document.getElementById('preview-total').textContent = formatCurrency(total);
            }

            function createItemRow(id) {
                // Form Row
                const formRow = document.createElement('div');
                formRow.className = 'item-row grid grid-cols-12 gap-2 items-center';
                formRow.innerHTML = `
                    <input type="text" data-id="${id}" placeholder="Deskripsi Item" class="form-input col-span-12 sm:col-span-5 item-description">
                    <input type="number" data-id="${id}" value="1" placeholder="Jumlah" class="form-input col-span-3 sm:col-span-2 text-center item-qty">
                    <input type="number" data-id="${id}" placeholder="Harga Satuan" class="form-input col-span-5 sm:col-span-3 text-right item-price">
                    <div class="col-span-4 sm:col-span-2 text-right">
                       <button class="remove-item text-red-500 hover:text-red-700 font-bold p-2" data-id="${id}">Hapus</button>
                    </div>
                `;
                itemList.appendChild(formRow);

                // Preview Row
                const previewRow = document.createElement('tr');
                previewRow.id = `preview-item-${id}`;
                previewRow.innerHTML = `
                    <td class="p-3 item-description">Deskripsi Item</td>
                    <td class="p-3 text-center item-qty">1</td>
                    <td class="p-3 text-right item-price">${formatCurrency(0)}</td>
                    <td class="p-3 text-right font-semibold item-total">${formatCurrency(0)}</td>
                `;
                previewItemList.appendChild(previewRow);
            }
            
            function updateItemPreview(id, field, value) {
                const previewRow = document.getElementById(`preview-item-${id}`);
                if (previewRow) {
                    const el = previewRow.querySelector(`.item-${field}`);
                    if (el) {
                        if(field === 'price') {
                            el.textContent = formatCurrency(value);
                        } else {
                             el.textContent = value || (field === 'description' ? 'Deskripsi Item' : '1');
                        }
                    }
                }
            }

            // Event Listeners
            Object.entries(bindings).forEach(([inputId, previewId]) => {
                const inputElement = document.getElementById(inputId);
                const previewElement = document.getElementById(previewId);
                if (inputElement && previewElement) {
                    previewElement.dataset.placeholder = previewElement.textContent; // Store initial placeholder
                    inputElement.addEventListener('input', () => updatePreview(inputId, previewId));
                    // Initial update for notes
                    if (inputId === 'notes') {
                        updatePreview(inputId, previewId);
                    }
                }
            });

            document.getElementById('invoice-date').addEventListener('change', () => updateDate('invoice-date', 'preview-invoice-date'));

            document.getElementById('add-item').addEventListener('click', () => {
                createItemRow(itemCounter);
                itemCounter++;
            });

            document.getElementById('item-list').addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-item')) {
                    const id = e.target.dataset.id;
                    e.target.closest('.item-row').remove();
                    document.getElementById(`preview-item-${id}`).remove();
                    calculateTotals();
                }
            });
            
            document.getElementById('item-list').addEventListener('input', (e) => {
                const id = e.target.dataset.id;
                if (e.target.classList.contains('item-description')) {
                    updateItemPreview(id, 'description', e.target.value);
                } else if (e.target.classList.contains('item-qty')) {
                    updateItemPreview(id, 'qty', e.target.value);
                } else if (e.target.classList.contains('item-price')) {
                    updateItemPreview(id, 'price', e.target.value);
                }
                calculateTotals();
            });

            document.getElementById('tax-rate').addEventListener('input', calculateTotals);

            document.getElementById('paid-status').addEventListener('change', (e) => {
                const statusWrapper = document.getElementById('payment-status-wrapper');
                if (e.target.checked) {
                    statusWrapper.style.display = 'block';
                } else {
                    statusWrapper.style.display = 'none';
                }
            });
            
            document.getElementById('print-btn').addEventListener('click', () => {
                window.print();
            });
            
            // Set initial dates
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('invoice-date').value = todayString;
            
            // Trigger initial date update
            updateDate('invoice-date', 'preview-invoice-date');

            // Add one initial item
            createItemRow(itemCounter);
            itemCounter++;
            
            // Set default notes on preview
            document.getElementById('preview-notes').textContent = document.getElementById('notes').placeholder;

        });
    </script>

</body>
</html>









